<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DimeX Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
<script src="https://unpkg.com/@walletconnect/ethereum-provider@2.11.0/dist/index.umd.js"></script>

<style>
body{background:#000;color:#fff;font-family:Arial;text-align:center}
.btn{background:gold;border:none;padding:12px 18px;margin:6px;border-radius:8px;font-weight:bold}
.card{background:#111;margin:12px auto;padding:14px;border-radius:10px;width:92%;max-width:420px}
.stat{color:gold;font-size:18px}
.popup{
position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,0.9);display:none;overflow:auto
}
.popupContent{background:#111;margin:40px;padding:20px;border-radius:10px}
</style>
</head>

<body>

<h2>DimeX Dashboard</h2>

<button class="btn" onclick="connect()">CONNECT WALLET</button>
<div id="wallet"></div>

<div class="card">Total Stake<div id="totalStake" class="stat">0</div></div>
<div class="card">Daily Reward<div id="dailyReward" class="stat">0</div></div>
<div class="card">Direct Income<div id="directIncome" class="stat">0</div></div>
<div class="card">Level Income<div id="levelIncome" class="stat">0</div></div>
<div class="card">Total Income<div id="totalIncome" class="stat">0</div></div>
<div class="card">Team Count<div id="teamCount" class="stat">0</div></div>

<button class="btn" onclick="openDownline()">VIEW DOWNLINE</button>
<button class="btn" onclick="openClaims()">CLAIM HISTORY</button>
<button class="btn" onclick="claim()">CLAIM</button>

<!-- DOWNLINE POPUP -->
<div id="downlinePopup" class="popup">
<div class="popupContent">
<h3>Downline</h3>
<div id="downlineData"></div>
<button class="btn" onclick="closeDownline()">CLOSE</button>
</div>
</div>

<!-- CLAIM POPUP -->
<div id="claimPopup" class="popup">
<div class="popupContent">
<h3>Claim History</h3>
<div id="claimData"></div>
<button class="btn" onclick="closeClaims()">CLOSE</button>
</div>
</div>

<script>

let provider, signer, staking;

const STAKING="PASTE_STAKING_ADDRESS";

const ABI=[
"function userInfo(address) view returns(uint,uint,uint,uint,uint,uint)",
"function getDownline(address) view returns(address[])",
"function getClaims(address) view returns(uint[])",
"function claim()"
];

async function connect(){

let p;

if(window.ethereum){
p=new ethers.providers.Web3Provider(window.ethereum);
await p.send("eth_requestAccounts",[]);
}else{
const wc=await window.EthereumProvider.init({
projectId:"62a73933d62534edcd2f54b8a06c4319",
chains:[56],
showQrModal:true
});
await wc.enable();
p=new ethers.providers.Web3Provider(wc);
}

provider=p;
signer=p.getSigner();
staking=new ethers.Contract(STAKING,ABI,signer);

let addr=await signer.getAddress();
document.getElementById("wallet").innerHTML=addr;

loadData();
setInterval(loadData,10000); // auto refresh
}

async function loadData(){

let addr=await signer.getAddress();
let d=await staking.userInfo(addr);

document.getElementById("totalStake").innerHTML=d[0];
document.getElementById("dailyReward").innerHTML=d[1];
document.getElementById("directIncome").innerHTML=d[2];
document.getElementById("levelIncome").innerHTML=d[3];
document.getElementById("totalIncome").innerHTML=d[4];
document.getElementById("teamCount").innerHTML=d[5];

}

async function openDownline(){
let addr=await signer.getAddress();
let list=await staking.getDownline(addr);

let html="";
list.forEach(a=>{
html+=a+"<br>";
});

document.getElementById("downlineData").innerHTML=html;
document.getElementById("downlinePopup").style.display="block";
}

function closeDownline(){
document.getElementById("downlinePopup").style.display="none";
}

async function openClaims(){
let addr=await signer.getAddress();
let list=await staking.getClaims(addr);

let html="";
list.forEach(a=>{
html+=a+"<br>";
});

document.getElementById("claimData").innerHTML=html;
document.getElementById("claimPopup").style.display="block";
}

function closeClaims(){
document.getElementById("claimPopup").style.display="none";
}

async function claim(){
await staking.claim();
}

</script>

</body>
  </html>
